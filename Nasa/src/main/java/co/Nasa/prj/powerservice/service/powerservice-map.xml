<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.Nasa.prj.powerservice.service.PowerServiceMapper">

	<select id="PowerServiceList" resultType="co.Nasa.prj.comm.VO.PowerServiceVO">
		SELECT * FROM V_POWER_LIST
		WHERE S_STATUS='U' AND SYSDATE BETWEEN POWER_START AND POWER_END
	</select>
	
	<select id="endPower" resultType="String">
		<![CDATA[
		SELECT MAX(POWER_END) 
		FROM POWERSERVICE 
		WHERE SER_CODE = #{ser_code} 
		AND TO_CHAR(SYSDATE, 'YYYY-MM-DD') < POWER_END ]]>
	</select>
	
	<insert id="powerserviceInsert" parameterType="co.Nasa.prj.comm.VO.PowerServiceVO">
		INSERT INTO POWERSERVICE 
		VALUES((SELECT NVL(MAX(POWER_CODE),0)+1 FROM POWERSERVICE ), #{s_email}, 
		#{ser_code}, #{power_start}, to_date(#{power_start},'yyyy-MM-dd')+6, sysdate, #{power_price})
	</insert>
	
	<select id="powerServiceCount" resultType="int">
		SELECT COUNT(*) 
		FROM POWERSERVICE 
		GROUP BY POWER_START 
		HAVING POWER_START= #{power_start}
	</select>
	
	<select id="powerServiceOverlap" resultType="co.Nasa.prj.comm.VO.PowerServiceVO">
		SELECT * 
		FROM POWERSERVICE 
		WHERE POWER_START = #{power_start} AND SER_CODE = #{ser_code}
	</select>
</mapper>