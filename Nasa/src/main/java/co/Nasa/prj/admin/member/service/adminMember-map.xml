<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.Nasa.prj.admin.member.service.AdminMemberMapper">

	
	<select id="selectBuyer" parameterType="String" resultType="co.Nasa.prj.admin.service.AdminAuthorVO">
		SELECT * FROM BUYER
		WHERE B_EMAIL= #{b_email}
		
	</select>
	
	<select id="selectBuyerPayment" parameterType="co.Nasa.prj.admin.service.Criteria" resultType="co.Nasa.prj.admin.service.AdminAuthorVO">
		<![CDATA[
		  SELECT *
			FROM 
			    (
			    select rownum rn, b.*
			    from v_buyerpayment b
			    WHERE b_email=#{b_email} AND ROWNUM <=#{pageNum} * #{amount}
			    )
		
		  WHERE rn>(#{pageNum}-1)*#{amount}
		]]>
		
		
	</select>
	
	<select id="sellerList" resultType="co.Nasa.prj.comm.VO.SellerVO">
		SELECT * FROM SELLER ORDER BY s_date
	</select>
	
	<sql id="buyerCriteria">
		<trim prefix="(" suffix=") AND" prefixOverrides="OR">
		   <foreach item='type' collection="typeArr">
		   	 <trim prefix="OR">
		   		<choose>
		   			<when test="type =='b_email'.toString()">
		   				b_email like '%'||#{keyword}||'%'
		   			</when>
		   			<when test="type == 'b_nickname'.toString()">
		   				b_nickname like '%'||#{keyword}||'%'
		   			</when>
		   			<when test="type == 'b_name'.toString()">
		   				b_name like '%'||#{keyword}||'%'
		   			</when>
		   			<when test="type == 'b_tel'.toString()">
		   				b_tel like '%'||#{keyword}||'%'
		   			</when>
		   			<when test="type == 'b_address'.toString()">
		   				b_address like '%'||#{keyword}||'%'
		   			</when>
		   			<when test="type == 'b_rank'.toString()">
		   				b_rank like '%'||#{keyword}||'%'
		   			</when>
		   		</choose>
		   	 </trim>
		   </foreach>
		</trim>
	</sql>
	<select id="getListWithPaging" resultType="co.Nasa.prj.comm.VO.BuyerVO">
		<![CDATA[
		 SELECT *
		 FROM 
		     (
		      SELECT rownum rn, b.*
		      FROM
		        buyer b
		      where
		]]>
		
		<include refid="buyerCriteria"></include>
		
		<![CDATA[
			rownum <= #{pageNum} * #{amount}
			)
			
		where rn > (#{pageNum}-1)*#{amount}
		
		]]>
	
	</select>
	
	<select id="getBuyerTotal" resultType="int">
		select count(*) as total from buyer
	</select>
	
	<select id="getSellerTotal" resultType="int">
		select count(*) as total from seller	
	</select>
	
	<update id="updateMemberRank" parameterType="co.Nasa.prj.comm.VO.BuyerVO">
		update buyer
		set b_rank = #{b_rank}
		where b_email=#{b_email}
	
	</update>
</mapper>