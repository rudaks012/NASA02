<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.Nasa.prj.payment.service.PaymentMapper">
   <select id="buyerPaymentList" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT *
      FROM PAYMENT
      WHERE B_EMAIL = #{b_email}
      ORDER BY PAY_DATE DESC
   </select>
   
   <select id="selectPagingBuyerPaymentList" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT	ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT 	*
   				 		 FROM 		PAYMENT
   				 		 WHERE 		B_EMAIL = #{b_email}
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countPagingBuyerPayment" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email}
   </select>
   
   <select id="monthSearch" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT	*
   				 		 FROM		PAYMENT
   				 		 WHERE		B_EMAIL = #{b_email} AND PAY_DATE >= ADD_MONTH(sysdate, -1)
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   
   <!-- 차트 입력 -->
   <select id="selectListChart" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT PAY_DATE,PAY_PRICE FROM PAYMENT
   </select>
   
   <!-- 테이블 입력할때 씀 -->
   <select id="selectpaymenttable" resultType="int" parameterType="int">
      SELECT NVL(SUM(PAY_PRICE),0)
      FROM PAYMENT
      WHERE SUBSTR(PAY_DATE,6,2) =#{num}
   </select>
   
   <select id="countservice" resultType="int" parameterType="int">
      SELECT COUNT(*) 
      FROM PAYMENT
      WHERE SUBSTR(PAY_DATE,6,2) =#{num}
   </select>
   
   <!-- 연도별 차트 입력 -->
   <select id="selectListYearChart" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT PAY_DATE,PAY_PRICE FROM PAYMENT
   </select>
   
   <!-- 연도별 누적 판매금액,  수수료 -->
   <select id="selectYearchart" resultType="int" parameterType="int">
      SELECT NVL(SUM(PAY_PRICE),0)
       FROM PAYMENT
       WHERE SUBSTR(PAY_DATE,0,4) = #{num}
   </select>
   
   <!-- 연도별 누적 판매 수량 -->
   <select id="countYearChart" resultType="int" parameterType="int">
       SELECT COUNT(*)
          FROM PAYMENT
        WHERE SUBSTR(PAY_DATE,0,4) = #{num}
   </select>
   

	<!-- 채팅 결제 -->
	<insert id="insertchatpayment"  parameterType="co.Nasa.prj.comm.VO.PaymentVO">
INSERT INTO	PAYMENT
	(PAY_CODE,
	B_EMAIL,
	S_EMAIL,
	S_CODE,
	PAY_DATE,
	PAY_CATE,
	PAY_CATE1,
	PAY_TYPE,
	PAY_COUPON,
	PAY_PRICE,
	PAY_ENDDATE,
	EVENT_START,
	EVENT_END,
	PAY_ORIGINP,
	PAY_COM)
	VALUES(
	(SELECT NVL(MAX(TO_NUMBER(PAY_CODE)),0) +1 FROM PAYMENT),
	#{b_email},
	#{s_email},
	#{s_code},
	sysdate,
	'CAT2',
	'SUB2-3',
	'PAY_TPYE',
	#{pay_coupon},
	#{pay_price},
	#{pay_enddate},
	#{event_start},
	#{event_end},
	#{pay_originp},
	'수수료')
</insert>
	

</mapper>