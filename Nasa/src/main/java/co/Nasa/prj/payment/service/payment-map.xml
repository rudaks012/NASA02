<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.Nasa.prj.payment.service.PaymentMapper">
   <select id="buyerPaymentList" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT *
      FROM PAYMENT
      WHERE B_EMAIL = #{b_email}
      ORDER BY PAY_DATE DESC
   </select>
   
   <select id="selectPagingBuyerPaymentList" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT	ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT 	*
   				 		 FROM 		PAYMENT
   				 		 WHERE 		B_EMAIL = #{b_email}
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countPagingBuyerPayment" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email}
   </select>
   
   <select id="monthSearch" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT	*
   				 		 FROM		PAYMENT
   				 		 WHERE		B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -1) AND SYSDATE
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countMonthSearch" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -1) AND SYSDATE
   </select>
   
   <select id="sixmonthSearch" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT	*
   				 		 FROM		PAYMENT
   				 		 WHERE		B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -6) AND SYSDATE
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countSixmonthSearch" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -6) AND SYSDATE
   </select>
   
   <select id="yearSearch" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT	*
   				 		 FROM		PAYMENT
   				 		 WHERE		B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -12) AND SYSDATE
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countYearSearch" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email} AND PAY_DATE BETWEEN ADD_MONTHS(sysdate, -12) AND SYSDATE
   </select>
   
   <select id="selectdateSearch" resultType="co.Nasa.prj.comm.VO.PaymentVO">
   		SELECT	*
   		FROM	(
   				 SELECT ROWNUM RN, A.*
   				 FROM	(
   				 		 SELECT	*
   				 		 FROM		PAYMENT
   				 		 WHERE		B_EMAIL = #{b_email} AND PAY_DATE BETWEEN #{firstDate} AND #{secondDate}
   				 		 ORDER BY	PAY_DATE DESC
   				 ) A
   		)
   		WHERE	RN BETWEEN #{start} AND #{end}
   </select>
   
   <select id="countSelectdateSearch" resultType="int">
   		SELECT	COUNT(*)
   		FROM	PAYMENT
   		WHERE	B_EMAIL = #{b_email} AND PAY_DATE BETWEEN #{firstDate} AND #{secondDate}
   </select>
   
   
   <!-- 차트 입력 -->
   <select id="selectListChart" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT PAY_DATE,PAY_PRICE FROM PAYMENT
   </select>
   
   <!-- 테이블 입력할때 씀 -->
   <select id="selectpaymenttable" resultType="int" parameterType="int">
      SELECT NVL(SUM(PAY_PRICE),0)
      FROM PAYMENT
      WHERE SUBSTR(PAY_DATE,4,2) =#{num}
   </select>
   
   <select id="countservice" resultType="int" parameterType="int">
      SELECT COUNT(*) 
      FROM PAYMENT
      WHERE SUBSTR(PAY_DATE,4,2) =#{num}
   </select>
   
   <!-- 연도별 차트 입력 -->
   <select id="selectListYearChart" resultType="co.Nasa.prj.comm.VO.PaymentVO">
      SELECT PAY_DATE,PAY_PRICE FROM PAYMENT
   </select>
   
   <!-- 연도별 누적 판매금액,  수수료 -->
   <select id="selectYearchart" resultType="int" parameterType="int">
      SELECT NVL(SUM(PAY_PRICE),0)
       FROM PAYMENT
       WHERE SUBSTR(PAY_DATE,0,2) = #{num}
   </select>
   
   <!-- 연도별 누적 판매 수량 -->
   <select id="countYearChart" resultType="int" parameterType="int">
       SELECT COUNT(*)
          FROM PAYMENT
        WHERE SUBSTR(PAY_DATE,0,2) = #{num}
   </select>
   

	<!-- 채팅 결제 -->
	<insert id="insertchatpayment"  parameterType="co.Nasa.prj.comm.VO.PaymentVO">
INSERT INTO	PAYMENT
	(PAY_CODE,
	B_EMAIL,
	S_EMAIL,
	S_CODE,
	PAY_DATE,
	PAY_CATE,
	PAY_CATE1,
	PAY_TYPE,
	PAY_COUPON,
	PAY_PRICE,
	PAY_ENDDATE,
	EVENT_START,
	EVENT_END,
	PAY_ORIGINP,
	PAY_COM)
	VALUES(
	(SELECT NVL(MAX(TO_NUMBER(PAY_CODE)),0) +1 FROM PAYMENT),
	#{b_email},
	#{s_email},
	#{s_code},
	sysdate,
	#{pay_cate},
	'SUB2-3',
	'PAY_TPYE',
	#{pay_coupon},
	#{pay_price},
	#{pay_enddate},
	#{event_start},
	#{event_end},
	#{pay_originp},
	#{pay_com})
</insert>
	
	<select id="sellerSalesData" resultType="co.Nasa.prj.comm.VO.PaymonthVO">
		SELECT 
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'01',pay_price,0)) AS  "january",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'02',pay_price,0)) AS  "february", 
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'03',pay_price,0)) AS  "march",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'04',pay_price,0)) AS  "april",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'05',pay_price,0)) AS  "may",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'06',pay_price,0)) AS  "june",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'07',pay_price,0)) AS  "july",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'08',pay_price,0)) AS  "august",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'09',pay_price,0)) AS  "september",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'10',pay_price,0)) AS  "october",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'11',pay_price,0)) AS  "november",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'12',pay_price,0)) AS  "december"
          FROM payment 
          WHERE  S_EMAIL= #{s_email} AND  SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),0,4)= #{year}
          AND S_CODE = #{scode}
	</select>

	<select id="sellerCommData" resultType="co.Nasa.prj.comm.VO.PaymonthVO">
		 SELECT 
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'01',pay_originp*(pay_com/10),0)) AS  "january",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'02',pay_originp*(pay_com/10),0)) AS  "february", 
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'03',pay_originp*(pay_com/10),0)) AS  "march",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'04',pay_originp*(pay_com/10),0)) AS  "april",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'05',pay_originp*(pay_com/10),0)) AS  "may",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'06',pay_originp*(pay_com/10),0)) AS  "june",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'07',pay_originp*(pay_com/10),0)) AS  "july",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'08',pay_originp*(pay_com/10),0)) AS  "august",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'09',pay_originp*(pay_com/10),0)) AS  "september",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'10',pay_originp*(pay_com/10),0)) AS  "october",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'11',pay_originp*(pay_com/10),0)) AS  "november",
            SUM(DECODE(SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),6,2),'12',pay_originp*(pay_com/10),0)) AS  "december"
          FROM payment 
          WHERE s_email= #{s_email} and  SUBSTR(to_char(pay_enddate,'yyyy-mm-dd'),0,4) = #{year}
          AND S_CODE = #{scode}
	</select>
	
	<select id="sellerPaymentList" resultType="co.Nasa.prj.comm.VO.PaymentVO">
		SELECT P.*, B.B_NICKNAME 
		FROM (
			SELECT P.*, S.SER_TITLE 
			FROM PAYMENT P, SERVICE S 
			WHERE P.S_CODE=S.SER_CODE 
			AND S.S_EMAIL =  #{s_email}) P , BUYER B 
		WHERE P.B_EMAIL = B.B_EMAIL
	</select>
	
	<update id="updateChaypayment" parameterType="co.Nasa.prj.comm.VO.PaymentVO">
		UPDATE BUYER SET 
		BUYER_COUPON ='0'
		WHERE B_EMAIL = #{b_email}
	</update>
</mapper>