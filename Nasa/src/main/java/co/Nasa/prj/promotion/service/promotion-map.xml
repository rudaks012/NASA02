<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.Nasa.prj.promotion.service.PromotionMapper">

<insert id="promotionInsert" parameterType="co.Nasa.prj.comm.VO.PromotionVO">
	<selectKey keyProperty="pro_code" resultType="string" order="BEFORE">
      SELECT NVL(MAX(TO_NUMBER(pro_code)),0)+1 FROM PROMOTION   
   </selectKey>
	INSERT INTO PROMOTION
	VALUES(#{pro_code},#{s_email},#{prodiscount},#{pro_start}, #{pro_end}, #{pro_service})
</insert>

<select id="promotionList" resultType="co.Nasa.prj.comm.VO.PromotionVO">
	select p.*, s.ser_title, s.ser_img 
	from promotion p, service s 
	where pro_service = ser_code
</select>

<select id="endPromotion" resultType="co.Nasa.prj.comm.VO.PromotionVO">
	<![CDATA[
	SELECT MAX(PRO_END) 
	FROM PROMOTION 
	WHERE PRO_SERVICE = #{pro_service}
	AND TO_CHAR(SYSDATE, 'YYYY-MM-DD') < PRO_END]]>
</select>

<select id="promotionCheck" resultType="co.Nasa.prj.comm.VO.PromotionVO">
	SELECT *
	FROM PROMOTION
	WHERE PRO_SERVICE = #{pro_service} 
	AND #{pro_start} BETWEEN PRO_START AND PRO_END
</select>
</mapper>